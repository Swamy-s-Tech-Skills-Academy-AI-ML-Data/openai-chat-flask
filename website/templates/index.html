{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block content %}
<div class="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow">
    <h2 class="text-xl font-semibold mb-4">Chat with Azure OpenAI ðŸ¤–</h2>
    <div id="chat-box" class="bg-gray-100 h-64 overflow-y-auto p-4 rounded mb-4"></div>
    <div class="flex space-x-2">
        <input id="user-input" type="text" placeholder="Type your message..."
            class="flex-grow border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring focus:ring-blue-300" />
        <button id="send-btn"
            class="bg-blue-600 text-white font-semibold px-4 py-2 rounded hover:bg-blue-700 transition">
            Send
        </button>
    </div>
</div>

<script>
    const chatBox = document.getElementById("chat-box");
    const userInput = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");

    sendBtn.addEventListener("click", async () => {
        const message = userInput.value.trim();
        if (!message) return;

        // Display user's message
        chatBox.innerHTML += `<p class="mb-1"><strong>You:</strong> ${message}</p>`;
        userInput.value = "";

        try {
            const res = await fetch("/api/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message })
            });
            const data = await res.json();
            if (data.response) {
                chatBox.innerHTML += `<p class="mb-2"><strong>Bot:</strong> ${data.response}</p>`;
            } else if (data.error) {
                chatBox.innerHTML += `<p class="mb-2 text-red-500"><strong>Error:</strong> ${data.error}</p>`;
            }
            chatBox.scrollTop = chatBox.scrollHeight;
        } catch (error) {
            chatBox.innerHTML += `<p class="mb-2 text-red-500"><strong>Error:</strong> ${error}</p>`;
        }
    });
</script>
{% endblock %}